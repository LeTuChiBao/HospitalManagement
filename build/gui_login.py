
# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer


from pathlib import Path
# from tkinter import *
# Explicit imports to satisfy Flake8
from tkinter import Tk, Canvas, Entry, Text, Button, PhotoImage, messagebox
from Ket_NoiSQL import MSSQLConnection


class LoginWindow:
    def __init__(self):
        self.OUTPUT_PATH = Path(__file__).parent
        self.ASSETS_PATH = self.OUTPUT_PATH / Path(r"C:\Users\bao.le\Pycode\Do_An\build\assets_login\frame0")


    def relative_to_assets(self,path: str) -> Path:
        return self.ASSETS_PATH / Path(path)

    def UIlogin_window(self):
        self.window = Tk()

        self.window.geometry("1000x500+400+300")
        self.window.configure(bg = "#FFFFFF")



        canvas = Canvas(
            self.window,
            bg = "#FFFFFF",
            height = 500,
            width = 1000,
            bd = 0,
            highlightthickness = 0,
            relief = "ridge"
        )

        canvas.place(x = 0, y = 0)
        canvas.create_text(
            195.0,
            70.0,
            anchor="nw",
            text="LOGIN",
            fill="#9377EE",
            font=("RobotoRoman Bold", 40 * -1)
        )

        canvas.create_text(
            99.0,
            123.0,
            anchor="nw",
            text="User name:",
            fill="#555454",
            font=("RobotoRoman Bold", 16 * -1)
        )

        entry_image_1 = PhotoImage(
            file=self.relative_to_assets("entry_1.png"))
        entry_bg_1 = canvas.create_image(
            253.0,
            167.0,
            image=entry_image_1
        )
        self.entry_1 = Entry(
            bd=0,
            bg="#E3E3E3",
            fg="#000716",
            highlightthickness=0,
            font=("RobotoRoman Bold", 16 * -1)
        )
        self.entry_1.place(
            x=101.0,
            y=147.0,
            width=304.0,
            height=38.0
        )

        canvas.create_text(
            99.0,
            200.0,
            anchor="nw",
            text="Password:",
            fill="#555454",
            font=("RobotoRoman Bold", 16 * -1)
        )

        canvas.create_text(
            119.0,
            394.0,
            anchor="nw",
            text="Donâ€™t have an account",
            fill="#555454",
            font=("RobotoRoman Regular", 16 * -1)
        )

        entry_image_2 = PhotoImage(
            file=self.relative_to_assets("entry_2.png"))
        entry_bg_2 = canvas.create_image(
            253.0,
            244.0,
            image=entry_image_2
        )
        self.entry_2 = Entry(
            bd=0,
            bg="#E3E3E3",
            fg="#000716",
            highlightthickness=0,
            font=("RobotoRoman Bold", 16 * -1)
        )
        self.entry_2.place(
            x=101.0,
            y=224.0,
            width=304.0,
            height=38.0
        )

        button_image_1 = PhotoImage(
            file=self.relative_to_assets("button_1.png"))
        self. button_1 = Button(
            image=button_image_1,
            borderwidth=0,
            highlightthickness=0,
            command=lambda: self.check_login_click(),
            relief="flat"
        )
        self.button_1.place(
            x=171.0,
            y=332.0,
            width=164.0,
            height=40.0
        )

        button_image_2 = PhotoImage(
            file=self.relative_to_assets("button_2.png"))
        self.button_2 = Button(
            image=button_image_2,
            borderwidth=0,
            highlightthickness=0,
            command=lambda: self.check_Register_click(),
            relief="flat"
        )
        self.button_2.place(
            x=284.0,
            y=391.0,
            width=103.0,
            height=26.0
        )

        button_image_3 = PhotoImage(
            file=self.relative_to_assets("button_3.png"))
        self.button_3 = Button(
            image=button_image_3,
            borderwidth=0,
            highlightthickness=0,
            command=lambda: print("button_3 clicked"),
            relief="flat"
        )
        self.button_3.place(
            x=273.0,
            y=283.0,
            width=142.0,
            height=26.0
        )

        image_image_1 = PhotoImage(
            file=self.relative_to_assets("image_1.png"))
        image_1 = canvas.create_image(
            713.0,
            261.0,
            image=image_image_1
        )
        self.window.resizable(False, False)
        self.window.mainloop()

    def check_login_click(self):

        if self.entry_1.get() == "" and self.entry_2.get() == "":
            messagebox.showerror("Error","Please input Username and Password")
        else:
            try:
                SqlSever = MSSQLConnection()
                SqlSever.connect()
                Query1 = ('SELECT * FROM users WHERE username = ? and userpassword = ?')
                values =( self.entry_1.get(),self.entry_2.get() )
                result = SqlSever.query(Query1, values)
                print(result)
                if result == []:
                    messagebox.showerror("Error","Wrong Username or Password")
                else:
                    checkRole = result[0][-1]
                    if checkRole == 'Admin':
                        print(checkRole)
                    elif checkRole == 'Super':
                        self.SupperPage()
                    elif checkRole == 'Agent':
                        print('Agent: '+ checkRole)
                    else:
                        messagebox.showerror("Not Support", f"Not Support Role: {checkRole}")
            except Exception as e:
                messagebox.showerror("Error",f"Error: {e}")
            finally:
                SqlSever.close()
    def check_Register_click(self):
        self.window.destroy()
        from gui_regiter import RegisterWindow
        registerPage = RegisterWindow()
        registerPage.UIregister_window()

    def SupperPage(self):
        username = self.entry_1.get()
        self.window.destroy()
        from Hospital_Super import Hospital
        openUIRoleSuper = Hospital()
        openUIRoleSuper.mainRoleSuper(username)

if __name__ == '__main__':
    uilogin = LoginWindow()
    uilogin.UIlogin_window()